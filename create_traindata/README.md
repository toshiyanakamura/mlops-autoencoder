# 学習データ作成ツール (create_traindata)

Webカメラの映像から、異常検知AI（オートエンコーダー）の学習および評価に使用する画像データセットを作成するツールです。
マウスで指定した領域（ROI）を切り抜き、キー操作でフォルダを振り分けて保存することができます。

## 実行方法

プロジェクトのルートディレクトリで以下のコマンドを実行してください。

```bash
python create_traindata/main.py
```

## 操作ガイド

ツールが起動するとカメラ映像が表示されます。以下の手順でデータを収集します。

### 1. 撮影範囲の指定 (ROI設定)
画面上でマウスをドラッグして、学習対象（例：お菓子）を囲む赤い枠（ROI）を作成してください。この枠内の画像が保存されます。
※ `config.yaml` で `crop_size` を設定している場合は、中央固定枠となりマウス操作は不要です。

### 2. 保存モードの切り替え
数字キーを押して、画像の保存先フォルダを切り替えます。画面左上のステータス表示が変わります。

| キー | モード | 保存先 (役割) |
| :--- | :--- | :--- |
| **`1`** | **Train/Good** | `train/good` (学習用・正常データ) |
| **`2`** | **Test/Good** | `test/good` (評価用・正常データ) |
| **`3`** | **Test/Anomaly** | `test/anomaly` (評価用・異常データ) |

> **ヒント**: まずはモード `1` で「正常な状態」の画像をたくさん撮影し、その後モード `3` で「異常な状態（欠け、割れなど）」を撮影するのがおすすめです。

### 3. 撮影
以下のキーで画像を保存します。

| キー | 動作 |
| :--- | :--- |
| **`s`** | **1枚撮影 (Shot)** <br> 現在のフレームを1枚保存します。 |
| **`c`** | **連続撮影 (Continuous)** <br> キーを押している間、約1秒間隔で連続して保存します。手早く枚数を稼ぎたい時に便利です。 |

### 4. 終了
| キー | 動作 |
| :--- | :--- |
| **`q`** | ツールを終了します。 |

## データセットの保存先

撮影された画像は、`conf/config.yaml` の `target` で指定されたディレクトリ（デフォルトは `kinoko2`）の下に、自動的に以下の構造で保存されます。

```
kinoko2/
├── train/
│   └── good/      <-- モード1で保存
└── test/
    ├── good/      <-- モード2で保存
    └── anomaly/   <-- モード3で保存
```

## 設定の変更

`conf/config.yaml` ファイルを編集することで設定を変更できます。

*   **target**: データセットの保存先ディレクトリ名
*   **anomaly**: 異常データのクラス名（フォルダ名になります）
*   **camera**: 使用するカメラID（PC内蔵カメラやUSBカメラの切り替えに使用。0, 1, ...）
*   **crop_size**: 画像の切り抜きサイズを固定したい場合に `[幅, 高さ]` で指定します（例: `[256, 256]`）。指定しない場合はマウスで自由に選択できます。
